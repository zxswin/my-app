## 10.代码分割 react-lazy 延迟加载.md

- React 延迟加载

```tsx
/**
 * 1.在React16.6以上的版本懒加载组件无需安全任何依赖库
 * 2.使用React.lazy 和 Suspense技术实现懒加载
 * 3.React.lazy 和 Suspense目前并不支持服务器端渲染
 */
```

- React.lazy 的使用

```tsx
/**
 * 1.React.lazy的使用
 * React.lazy接收一个函数作为参数
 * 这个函数动态调用import() 并返回一个Promise
 * 返回的Promise需要resolve一个default export 的React组件
 *
 * 2.需要在Suspense组件中渲染lazy组件
 * 这样可以在等待加载lazy组件的时候做优雅降级(如显示loading……)
 * 接收一个fallback属性,该属性接收一个在加载过程中你要展示的React元素
 * 可以使用一个Suspence组件包裹多个需要懒加载的组件
 */

// LazyCom.tsx 一个需要进行延迟加载的组件
import React, { Component } from 'react';

class LazyCom extends Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <React.Fragment>
        <div>这是一个需要延迟加载的组件</div>
      </React.Fragment>
    );
  }
}

// 作为一个将被延迟加载的组件必须要有一个默认的返回
export default LazyCom;

// 在父组件中执行延迟加载的操作
import React, { Component, Suspense, lazy } from 'react'; // 引入Suspense lazy

// 需要延迟加载的组件变量名称必须和默认返回的组件名称一致
const LazyCom = lazy(() => import('../components/LazyCom'));

class HookCom extends Component<any, any> {
  constructor(props) {
    super(props);

    this.state = {
      lazyShow: false,
    };
  }

  handleLoadLazyComponent = () => {
    setTimeout(() => {
      this.setState({
        lazyShow: true,
      });
    }, 1000);
  };
  render() {
    return (
      <React.Fragment>
        <button onClick={this.handleLoadLazyComponent}>
          对延迟加载组件进行加载
        </button>

        {/** 通过使用Suspense组件中包裹需要被延迟加载的数据 通过fallback来显示加载中的样式 */}
        <Suspense fallback={<div>加载中……</div>}>
          {this.state.lazyShow && <LazyCom />}
        </Suspense>
      </React.Fragment>
    );
  }
}

export default HookCom;
```

- 通过中间模块导出默认模块

```tsx
/**
 * 有些模块并没有默认的导出模块
 * 这个需要需要使用中间模块来设置默认导出的模块
 */

// ManyComponents.js
export const MyComponent = /* ... */;
export const MyUnusedComponent = /* ... */;

// MyComponent.js
export { MyComponent as default } from "./ManyComponents.js";

// MyApp.js
import React, { lazy } from 'react';
const MyComponent = lazy(() => import("./MyComponent.js"));
```
