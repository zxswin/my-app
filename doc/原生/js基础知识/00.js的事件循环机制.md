## js 的事件循环机制.md

```ts
/**
 *
 * 关于浏览器
 * 1.浏览器是多进程的，浏览器渲染进程（浏览器内核）属于浏览器多进程中的一种，主要负责页面渲染，脚本执行，事件处理等
 * 2.其包含的线程有：
 * GUI（图形用户界面）渲染线程（负责渲染页面，解析 HTML，CSS 构成 DOM 树）、
 * JS 引擎线程、
 * 事件触发线程、
 * 定时器触发线程、
 * http 请求线程等主要线程
 *
 * 执行中的线程
 * 主线程：也就是 js 引擎执行的线程，这个线程只有一个，页面渲染、函数处理都在这个主线程上执行。
 * 工作线程：也称幕后线程，这个线程可能存在于浏览器或js引擎内，与主线程是分开的，处理文件读取、网络请求等异步事件。
 *
 * 任务队列( Event Queue )
 * 所有的任务可以分为同步任务和异步任务
 * 同步任务，顾名思义，就是立即执行的任务，同步任务一般会直接进入到主线程中执行
 * 而异步任务，就是异步执行的任务，比如ajax网络请求，setTimeout 定时函数等都属于异步任务
 * 异步任务会通过任务队列的机制(先进先出的机制)来进行协调。
 *
 *
 * Event Loop (事件循环)
 * 同步和异步任务分别进入不同的执行环境
 * 同步的进入主线程，即主执行栈，异步的进入任务队列。
 * 主线程内的任务执行完毕为空，会去任务队列读取对应的任务，推入主线程执行。
 *
 * 在事件循环中，每进行一次循环操作称为tick
 * 1.在此次 tick 中选择最先进入队列的任务，如果有则执行(一次)
 * 2.检查是否存在微任务，如果存在则不停地执行，直至清空微任务队列
 * 3.更新 render
 * 4.主线程重复执行上述步骤
 *
 *
 * 即宏任务(macrotask)和微任务(microtask)，当主线程任务完成为空去Event Quenu读取函数的时候，
 * 是先读取的微任务，当微任务执行完毕之后，才会继续执行宏任务。
 *
 * 宏任务主要包含：script( 整体代码)、setTimeout、setInterval、I/O、UI 交互事件、setImmediate(Node.js 环境)
 * 微任务主要包含：Promise、MutaionObserver、process.nextTick(Node.js 环境)
 *
 * 在挂起任务时，JS 引擎会将所有任务按照类别分到这两个队列中，
 * 首先在 宏任务的队列（这个队列也被叫做 task queue）中取出第一个任务，
 * 执行完毕后取出微任务队列中的所有任务顺序执行；
 * 之后再取宏任务任务，周而复始，直至两个队列的任务都取完。
 *
 * JavaScript 是一门单线程语言，异步操作都是放到事件循环队列里面，等待主执行栈来执行的，并没有专门的异步执行线程
 */
```
