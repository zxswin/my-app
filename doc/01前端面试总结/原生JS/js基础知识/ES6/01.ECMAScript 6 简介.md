## ECMAScript 和 JavaScript 的关系

```js
// ECMAScript 和 JavaScript 的关系是，前者是后者的规格，后者是前者的一种实现（另外的 ECMAScript 方言还有 JScript 和 ActionScript）。日常场合，这两个词是可以互换的。
```

## ES6 与 ECMAScript 2015 的关系

```js
// 标准在每年的 6 月份正式发布一次，作为当年的正式版本。
// ES6 既是一个历史名词，也是一个泛指，含义是 5.1 版以后的 JavaScript 的下一代标准，涵盖了 ES2015、ES2016、ES2017 等等，而 ES2015 则是正式名称，特指该年发布的正式版本的语言标准。
```

## 语法提案的批准流程

```js
// 一种新的语法从提案到变成正式标准，需要经历五个阶段。每个阶段的变动都需要由 TC39 委员会批准。
// Stage 0 - Strawman（展示阶段）
// Stage 1 - Proposal（征求意见阶段）
// Stage 2 - Draft（草案阶段）
// Stage 3 - Candidate（候选人阶段）
// Stage 4 - Finished（定案阶段）

// Node.js 是 JavaScript 的服务器运行环境（runtime）。
// 使用下面的命令，可以查看 Node.js 默认没有打开的 ES6 实验性语法。

// Linux & Mac
// $ node --v8-options | grep harmony

// Windows
// $ node --v8-options | findstr harmony
```

## Babel 转码器

```js
// Babel 是一个广泛使用的 ES6 转码器，可以将 ES6 代码转为 ES5 代码
// 安装 Babel
// npm install --save-dev @babel/core
```

## 配置文件.babelrc

```js
// Babel 的配置文件是.babelrc，存放在项目的根目录下
// presets字段设定转码规则，官方提供以下的规则集，你可以根据需要安装。
// # 最新转码规则
// $ npm install --save-dev @babel/preset-env

// # react 转码规则
// $ npm install --save-dev @babel/preset-react

// 然后，将这些规则加入.babelrc。
```

```json
{
  "presets": ["@babel/env", "@babel/preset-react"],
  "plugins": []
}
```

## 命令行转码

```js
// Babel 提供命令行工具@babel/cli，用于命令行转码。

// 它的安装命令如下。
// $ npm install --save-dev @babel/cli

// # 转码结果输出到标准输出
// $ npx babel example.js

// # 转码结果写入一个文件
// # --out-file 或 -o 参数指定输出文件
// $ npx babel example.js --out-file compiled.js
// # 或者
// $ npx babel example.js -o compiled.js

// # 整个目录转码
// # --out-dir 或 -d 参数指定输出目录
// $ npx babel src --out-dir lib
// # 或者
// $ npx babel src -d lib

// # -s 参数生成source map文件
// $ npx babel src -d lib -s
```

## babel-node

```js
// @babel/node模块的babel-node命令，提供一个支持 ES6 的 REPL 环境。它支持 Node 的 REPL 环境的所有功能，而且可以直接运行 ES6 代码。

// 首先，安装这个模块。
// $ npm install --save-dev @babel/node

// 然后，执行babel-node就进入 REPL 环境。
// $ npx babel-node
// > (x => x * 2)(1)
// 2

// babel-node命令可以直接运行 ES6 脚本。将上面的代码放入脚本文件es6.js，然后直接运行。
// # es6.js 的代码
// # console.log((x => x * 2)(1));
// $ npx babel-node es6.js
// 2
```

## @babel/register 模块

```js
// @babel/register模块改写require命令，为它加上一个钩子。此后，每当使用require加载.js、.jsx、.es和.es6后缀名的文件，就会先用 Babel 进行转码。
// $ npm install --save-dev @babel/register
// 使用时，必须首先加载@babel/register。
// index.js
require('@babel/register');
require('./es6.js');

// 然后，就不需要手动对index.js转码了。
// $ node index.js
// 2

// 需要注意的是，@babel/register只会对require命令加载的文件转码，而不会对当前文件转码。另外，由于它是实时转码，所以只适合在开发环境使用。
```

## polyfill

```js
// Babel 默认只转换新的 JavaScript 句法（syntax），而不转换新的 API，比如Iterator、Generator、Set、Map、Proxy、Reflect、Symbol、Promise等全局对象，以及一些定义在全局对象上的方法（比如Object.assign）都不会转码。

// 举例来说，ES6 在Array对象上新增了Array.from方法。Babel 就不会转码这个方法。如果想让这个方法运行，可以使用core-js和regenerator-runtime(后者提供generator函数的转码)，为当前环境提供一个垫片。

// 安装命令如下。
// $ npm install --save-dev core-js regenerator-runtime

// 然后，在脚本头部，加入如下两行代码。

import 'core-js';
import 'regenerator-runtime/runtime';
// 或者
require('core-js');
require('regenerator-runtime/runtime');

// Babel 默认不转码的 API 非常多，详细清单可以查看babel-plugin-transform-runtime模块的definitions.js文件。
```

## 浏览器环境

```html
<!-- Babel 也可以用于浏览器环境，使用@babel/standalone模块提供的浏览器版本，将其插入网页。 -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
  // Your ES6 code
</script>
```

```js
// 注意，网页实时将 ES6 代码转为 ES5，对性能会有影响。生产环境需要加载已经转码完成的脚本。
// Babel 提供一个REPL 在线编译器，可以在线将 ES6 代码转为 ES5 代码。转换后的代码，可以直接作为 ES5 代码插入网页运行。
// https://babeljs.io/repl/
```
