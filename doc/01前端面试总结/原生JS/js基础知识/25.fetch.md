## fetch

```ts
/**
 * Fetch 提供了一个更理想的替代XMLHttpRequest的方案
 * 1.它返回的是一个Promise
 * 当接收到一个代表错误的 HTTP 状态码时, Promise 状态标记为 resolve,
 * 但是会将 resolve 的返回值的 ok 属性设置为 false
 * 当网络故障时或请求被阻止时，才会标记为 reject
 * 2.fetch 不会发送 cookies。除非你使用了credentials 的初始化选项。
 */

/* 一个基本的Fetch请求 */
fetch('http://example.com/movies.json')
  .then(function (response) {
    return response.json();
  })
  .then(function (myJson) {
    console.log(myJson);
  });

/**
 * 支持请求参数
 * fetch() 接受第二个可选参数，一个可以控制不同配置的 init 对象
 */
postData('http://example.com/answer', { answer: 42 })
  .then((data) => console.log(data)) // JSON from `response.json()` call
  .catch((error) => console.error(error));

function postData(url, data) {
  // Default options are marked with *
  return fetch(url, {
    body: JSON.stringify(data), // must match 'Content-Type' header
    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
    credentials: 'same-origin', // include, same-origin, *omit
    headers: {
      'user-agent': 'Mozilla/4.0 MDN Example',
      'content-type': 'application/json',
    },
    method: 'POST', // *GET, POST, PUT, DELETE, etc.
    mode: 'cors', // no-cors, cors, *same-origin
    redirect: 'follow', // manual, *follow, error
    referrer: 'no-referrer', // *client, no-referrer
  }).then((response) => response.json()); // parses response to JSON
}

/**
 * 使用 fetch() POST JSON数据
 */
var url = 'https://example.com/profile';
var data = { username: 'example' };

fetch(url, {
  method: 'POST', // or 'PUT'
  body: JSON.stringify(data), // data can be `string` or {object}!
  headers: new Headers({
    'Content-Type': 'application/json',
  }),
})
  .then((res) => res.json())
  .catch((error) => console.error('Error:', error))
  .then((response) => console.log('Success:', response));

/**
 * 检测请求是否成功
 * 如果遇到网络故障，fetch() promise 将会 reject，带上一个 TypeError 对象
 */
fetch('flowers.jpg')
  .then(function (response) {
    if (response.ok) {
      return response.blob();
    }
    throw new Error('Network response was not ok.');
  })
  .then(function (myBlob) {
    var objectURL = URL.createObjectURL(myBlob);
    myImage.src = objectURL;
  })
  .catch(function (error) {
    console.log(
      'There has been a problem with your fetch operation: ',
      error.message
    );
  });

/**
 * 自定义请求对象
 */
var myHeaders = new Headers();

var myInit = {
  method: 'GET',
  headers: myHeaders,
  mode: 'cors',
  cache: 'default',
};

var myRequest = new Request('flowers.jpg', myInit);

fetch(myRequest)
  .then(function (response) {
    return response.blob();
  })
  .then(function (myBlob) {
    var objectURL = URL.createObjectURL(myBlob);
    myImage.src = objectURL;
  });
```
