## 首要规则：永远不要使用不受信任的模板

```js
Vue.createApp({
  template: `<div>` + userProvidedString + `</div>`, // 永远不要这么做
}).mount('#app');
```

## Vue 如何保护你

- HTML 内容

```js
// 无论是使用模板还是渲染函数，内容都会自动转义。因此在这个模板中：

<h1>{{ userProvidedString }}</h1>

// 如果 userProvidedString 包含：
// '<script>alert("hi")</script>'

// 那么它将被转义为以下 HTML：
// &lt;script&gt;alert(&quot;hi&quot;)&lt;/script&gt;

// 从而防止脚本注入。这种转义是使用原生浏览器 API (例如 textContent) 完成的，因此只有当浏览器本身易受攻击时才会存在漏洞。
```

## attribute 绑定

```js
// 同样，动态 attribute 绑定也会自动转义。因此在这个模板中：
<h1 :title="userProvidedString">
  hello
</h1>

// 如果 userProvidedString 包含：
// '" onclick="alert(\'hi\')'

// 那么它将被转义为以下 HTML：
// &quot; onclick=&quot;alert('hi')

// 从而防止 title attribute 被提前关闭以注入新的、任意的 HTML。这种转义是使用原生浏览器 API (例如 setAttribute) 完成的，因此只有当浏览器本身易受攻击时才会存在漏洞。
```

## 注入 HTML

```js
// 正如你之前所看到的，Vue 会自动转义 HTML 内容，防止你意外地将可执行的 HTML 注入到你的应用程序中。但是，如果你确信某个 HTML 是安全的，你可以显式呈现 HTML 内容：

// 使用模板：
<div v-html="userProvidedHtml"></div>

// 使用渲染函数：
h('div', {
  innerHTML: this.userProvidedHtml
})

// 在 JSX 中使用渲染函数：
<div innerHTML={this.userProvidedHtml}></div>
```

## 注入 URL

```js

// 在这样的 URL 中：

<a :href="userProvidedUrl">
  click me
</a>
// 如果 URL 未经过“净化”处理来防止其通过 javascript: 执行 JavaScript，则会有潜在的安全隐患。有一些库例如 sanitize-url 可以帮助解决这个问题，但请注意：

// 如果你只在前端进行 URL 净化，那么你已经遇到了安全问题。在保存用户提供的 URL 到数据库之前，你的后端必须对其进行净化。只有这么做，才能避免 每个 连接到你 API 的客户端 (包括原生移动应用程序) 出现此类问题。另请注意，即便使用了经过净化的 URL，Vue 也无法保证它们指向安全的目标。

```

## 注入样式

```html
<a :href="sanitizedUrl" :style="userProvidedStyles"> click me </a>
<!-- 
为了让你的用户完全免受点击劫持，我们建议只允许用户完全控制 iframe 沙盒内的 CSS。或者，如果需要通过样式绑定来允许用户控制样式，我们建议使用它的对象语法，并且只允许用户为可以被安全控制的特定 property 提供值，如下所示： -->

<a
  :href="sanitizedUrl"
  :style="{
    color: userProvidedColor,
    background: userProvidedBackground
  }"
>
  click me
</a>
```

## 注入 JavaScript

```js
// 请注意，永远不要 100% 信任用户提供的 JavaScript，除非它位于 iframe 沙盒中，或位于仅有编写该 HTML 的用户才能接触到它的部分中。
```
