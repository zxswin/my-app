## Provide / Inject

```js
// 我们也可以在组合式 API 中使用 provide/inject。两者都只能在当前活动实例的 setup() 期间调用。
```

## 使用 Provide

```html
<!-- 
  在 setup() 中使用 provide 时，我们首先从 vue 显式导入 provide 方法。这使我们能够调用 provide 来定义每个 property。
  provide 函数允许你通过两个参数定义 property：
  name (<String> 类型)
  value
  使用 MyMap 组件后，provide 的值可以按如下方式重构：
-->

<!-- src/components/MyMap.vue -->
<template>
  <MyMarker />
</template>

<script>
  import { provide } from 'vue';
  import MyMarker from './MyMarker.vue';

  export default {
    components: {
      MyMarker,
    },
    setup() {
      provide('location', 'North Pole');
      provide('geolocation', {
        longitude: 90,
        latitude: 135,
      });
    },
  };
</script>
```

## 使用 inject

```html
<!-- 
  在 setup() 中使用 inject 时，也需要从 vue 显式导入。导入以后，我们就可以调用它来定义暴露给我们的组件方式。

  inject 函数有两个参数：

  要 inject 的 property 的 name
  默认值 (可选)
  使用 MyMarker 组件，可以使用以下代码对其进行重构：
-->

<!-- src/components/MyMarker.vue -->
<script>
  import { inject } from 'vue';

  export default {
    setup() {
      const userLocation = inject('location', 'The Universe');
      const userGeolocation = inject('geolocation');

      return {
        userLocation,
        userGeolocation,
      };
    },
  };
</script>
```

## 响应性

```html
<!-- 
  为了增加 provide 值和 inject 值之间的响应性，我们可以在 provide 值时使用 ref 或 reactive。
  使用 MyMap 组件，我们的代码可以更新如下：

  现在，如果这两个 property 中有任何更改，MyMarker 组件也将自动更新！
-->

<!-- src/components/MyMap.vue -->
<template>
  <MyMarker />
</template>

<script>
  import { provide, reactive, ref } from 'vue';
  import MyMarker from './MyMarker.vue';

  export default {
    components: {
      MyMarker,
    },
    setup() {
      const location = ref('North Pole');
      const geolocation = reactive({
        longitude: 90,
        latitude: 135,
      });

      provide('location', location);
      provide('geolocation', geolocation);
    },
  };
</script>
```

## 修改响应式 property

```html
<!-- 
  当使用响应式 provide / inject 值时，建议尽可能将对响应式 property 的所有修改限制在定义 provide 的组件内部。
  例如，在需要更改用户位置的情况下，我们最好在 MyMap 组件中执行此操作。
-->

<!-- src/components/MyMap.vue -->
<template>
  <MyMarker />
</template>

<script>
  import { provide, reactive, ref } from 'vue';
  import MyMarker from './MyMarker.vue';

  export default {
    components: {
      MyMarker,
    },
    setup() {
      const location = ref('North Pole');
      const geolocation = reactive({
        longitude: 90,
        latitude: 135,
      });

      provide('location', location);
      provide('geolocation', geolocation);

      return {
        location,
      };
    },
    methods: {
      updateLocation() {
        this.location = 'South Pole';
      },
    },
  };
</script>
```

## 最终用例

```html
<!-- 
  然而，有时我们需要在注入数据的组件内部更新 inject 的数据。在这种情况下，我们建议 provide 一个方法来负责改变响应式 property。
-->

<!-- src/components/MyMap.vue -->
<template>
  <MyMarker />
</template>

<script>
  import { provide, reactive, ref } from 'vue';
  import MyMarker from './MyMarker.vue';

  export default {
    components: {
      MyMarker,
    },
    setup() {
      const location = ref('North Pole');
      const geolocation = reactive({
        longitude: 90,
        latitude: 135,
      });

      const updateLocation = () => {
        location.value = 'South Pole';
      };

      provide('location', location);
      provide('geolocation', geolocation);
      provide('updateLocation', updateLocation);
    },
  };
</script>
```

```html
<!-- src/components/MyMarker.vue -->
<script>
  import { inject } from 'vue';

  export default {
    setup() {
      const userLocation = inject('location', 'The Universe');
      const userGeolocation = inject('geolocation');
      const updateUserLocation = inject('updateLocation');

      return {
        userLocation,
        userGeolocation,
        updateUserLocation,
      };
    },
  };
</script>
```

```html
<!-- 
  最后，如果要确保通过 provide 传递的数据不会被 inject 的组件更改，我们建议对提供者的 property 使用 readonly。
-->
<!-- src/components/MyMap.vue -->
<template>
  <MyMarker />
</template>

<script>
  import { provide, reactive, readonly, ref } from 'vue';
  import MyMarker from './MyMarker.vue';

  export default {
    components: {
      MyMarker,
    },
    setup() {
      const location = ref('North Pole');
      const geolocation = reactive({
        longitude: 90,
        latitude: 135,
      });

      const updateLocation = () => {
        location.value = 'South Pole';
      };

      provide('location', readonly(location));
      provide('geolocation', readonly(geolocation));
      provide('updateLocation', updateLocation);
    },
  };
</script>
```
