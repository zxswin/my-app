## 在动态组件上使用 keep-alive

```html
<div id="dynamic-component-demo" class="demo">
  <button
    v-for="tab in tabs"
    :key="tab"
    :class="['tab-button', { active: currentTab === tab }]"
    @click="currentTab = tab"
  >
    {{ tab }}
  </button>

  <component :is="currentTabComponent" class="tab"></component>
</div>
```

```js
const app = Vue.createApp({
  data() {
    return {
      currentTab: 'Home',
      tabs: ['Home', 'Posts', 'Archive'],
    };
  },
  computed: {
    currentTabComponent() {
      return 'tab-' + this.currentTab.toLowerCase();
    },
  },
});

app.component('tab-home', {
  template: `<div class="demo-tab">Home component</div>`,
});
app.component('tab-posts', {
  template: `<div class="dynamic-component-demo-posts-tab">
    <ul class="dynamic-component-demo-posts-sidebar">
      <li
        v-for="post in posts"
        :key="post.id"
        :class="{
          'dynamic-component-demo-active': post === selectedPost
        }"
        @click="selectedPost = post"
      >
        {{ post.title }}
      </li>
    </ul>
    <div class="dynamic-component-demo-post-container">
      <div v-if="selectedPost" class="dynamic-component-demo-post">
        <h3>{{ selectedPost.title }}</h3>
        <div v-html="selectedPost.content"></div>
      </div>
      <strong v-else>
        Click on a blog title to the left to view it.
      </strong>
    </div>
  </div>`,
  data() {
    return {
      posts: [
        {
          id: 1,
          title: 'Cat Ipsum',
          content:
            '<p>Dont wait for the storm to pass, dance in the rain kick up litter decide to want not</p>',
        },
        {
          id: 2,
          title: 'Hipster Ipsum',
          content: '<p>drinking vinegar gochujang.</p>',
        },
        {
          id: 3,
          title: 'Cupcake Ipsum',
          content: '<p>Liquorice candy macaroon toffee cookie marzipan.</p>',
        },
      ],
      selectedPost: null,
    };
  },
});
app.component('tab-archive', {
  template: `<div class="demo-tab">Archive component</div>`,
});

app.mount('#dynamic-component-demo');
```

- 缓存实例视图

```html
<!-- 
  希望那些标签的组件实例能够被在它们第一次被创建的时候缓存下来。
  可以用一个 <keep-alive> 元素将其动态组件包裹起来。
 -->

<!-- 失活的组件将会被缓存！-->
<keep-alive>
  <component :is="currentTabComponent"></component>
</keep-alive>
```

## 异步组件

```html
<!-- 
  在大型应用中，我们可能需要将应用分割成小一些的代码块，并且只在需要的时候才从服务器加载一个模块。为了实现这个效果，Vue 有一个 defineAsyncComponent 方法：

  此方法接受一个返回 Promise 的工厂函数。从服务器检索组件定义后，应调用 Promise 的 resolve 回调。你也可以调用 reject(reason)，来表示加载失败。
 -->
```

```js
const { createApp, defineAsyncComponent } = Vue;

const app = createApp({});

const AsyncComp = defineAsyncComponent(
  () =>
    new Promise((resolve, reject) => {
      resolve({
        template: '<div>I am async!</div>',
      });
    })
);

app.component('async-example', AsyncComp);
```

- 动态导入

```js
import { defineAsyncComponent } from 'vue';

const AsyncComp = defineAsyncComponent(() =>
  import('./components/AsyncComponent.vue')
);

app.component('async-component', AsyncComp);
```

- 在局部注册组件时，你也可以使用 defineAsyncComponent：

```js
import { createApp, defineAsyncComponent } from 'vue';

createApp({
  // ...
  components: {
    AsyncComponent: defineAsyncComponent(() =>
      import('./components/AsyncComponent.vue')
    ),
  },
});
```

## 与 Suspense 一起使用

```html
<!-- 
  异步组件在默认情况下是可挂起的。这意味着如果它在父链中有一个 <Suspense>，它将被视为该 <Suspense> 的异步依赖。在这种情况下，加载状态将由 <Suspense> 控制，组件自身的加载、错误、延迟和超时选项都将被忽略。
  通过在其选项中指定 suspensible: false，异步组件可以退出 Suspense 控制，并始终控制自己的加载状态。
-->
```
