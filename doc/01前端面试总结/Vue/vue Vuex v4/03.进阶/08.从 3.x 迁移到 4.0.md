## 非兼容性变更

```ts
// 为了与 Vue 3 初始化过程保持一致，Vuex 的安装方式已经改变了。用户现在应该使用新引入的 createStore 方法来创建 store 实例。

// 从技术上讲这并不是一个非兼容性变更，仍然可以使用 new Store(...) 语法，但是建议使用上述方式以保持与 Vue 3 和 Vue Router Next 的一致。

import { createStore } from 'vuex';

export const store = createStore({
  state() {
    return {
      count: 1,
    };
  },
});
```

```js
// 要将 Vuex 安装到 Vue 实例中，需要用 store 替代之前的 Vuex 传递给 use 方法。
import { createApp } from 'vue';
import { store } from './store';
import App from './App.vue';

const app = createApp(App);

app.use(store);

app.mount('#app');
```

## TypeScript 支持

```ts
// 为了修复 issue #994，Vuex 4 删除了 this.$store 在 Vue 组件中的全局类型声明。当使用 TypeScript 时，必须声明自己的模块补充(module augmentation)。

// 将下面的代码放到项目中，以允许 this.$store 能被正确的类型化：

// vuex-shim.d.ts

import { ComponentCustomProperties } from 'vue';
import { Store } from 'vuex';

declare module '@vue/runtime-core' {
  // 声明自己的 store state
  interface State {
    count: number;
  }

  interface ComponentCustomProperties {
    $store: Store<State>;
  }
}
```

## 新特性

```js
// 全新的“useStore”组合式函数
// Vuex 4 引入了一个新的 API 用于在组合式 API 中与 store 进行交互。可以在组件的 setup 钩子函数中使用 useStore 组合式函数来检索 store。

import { useStore } from 'vuex';

export default {
  setup() {
    const store = useStore();
  },
};
```
