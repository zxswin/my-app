## keyof 操作符

```ts
/**
 * TypeScript 允许我们遍历某种类型的属性，并通过 keyof 操作符提取其属性的名称
 * keyof 操作符可以用于获取某种类型的所有键，其返回类型是联合类型。
 * keyof 也称为输入索引类型查询
 */

interface Person {
  name: string;
  age: number;
  location: string;
}

type K1 = keyof Person; // "name" | "age" | "location"
type K2 = keyof Person[]; // number | "length" | "push" | "concat" | ...
type K3 = keyof { [x: string]: Person }; // string | number
```

- 对基础类型的支持

```ts
let K1: keyof boolean; // let K1: "valueOf"
let K2: keyof number; // let K2: "toString" | "toFixed" | "toExponential" | ...
let K3: keyof symbol; // let K1: "valueOf"
```

- keyof 也称为输入索引类型查询，与之相对应的是索引访问类型，也称为查找类型。

```ts
type P1 = Person['name']; // string
type P2 = Person['name' | 'age']; // string | number
type P3 = string['charAt']; // (pos: number) => string
type P4 = string[]['push']; // (...items: string[]) => number
type P5 = string[][0]; // string
```

- keyof 实用案例 1

```ts
type Todo = {
  id: number;
  text: string;
  done: boolean;
};

const todo: Todo = {
  id: 1,
  text: 'Learn TypeScript keyof',
  done: false,
};

function prop<T extends object, K extends keyof T>(obj: T, key: K) {
  return obj[key];
}

const id = prop(todo, 'id'); // const id: number
const text = prop(todo, 'text'); // const text: string
const done = prop(todo, 'done'); // const done: boolean
```

- keyof 与对象的数值属性

```ts
class ClassWithNumericProperty {
  [1]: string = 'Semlinker';
}

let classWithNumeric = new ClassWithNumericProperty();
console.log(`${classWithNumeric[1]} `);
```

- keyof 操作符安全地访问对象的属性

```ts
enum Currency {
  CNY = 6,
  EUR = 8,
  USD = 10,
}

const CurrencyName = {
  [Currency.CNY]: '人民币',
  [Currency.EUR]: '欧元',
  [Currency.USD]: '美元',
};

console.log(`CurrencyName[Currency.CNY] = ${CurrencyName[Currency.CNY]}`);
console.log(`CurrencyName[6] = ${CurrencyName[6]}`);

function getCurrencyName<T, K extends keyof T>(key: K, map: T): T[K] {
  return map[key];
}

console.log(`name = ${getCurrencyName(Currency.CNY, CurrencyName)}`);
```

- keyof 与 typeof 操作符之间的配合实用

```ts
const COLORS = {
  red: 'red',
  blue: 'blue',
};

// 首先通过typeof操作符获取color变量的类型，然后通过keyof操作符获取该类型的所有键，
// 即字符串字面量联合类型 'red' | 'blue'
type Colors = keyof typeof COLORS;
let color: Colors;
color = 'red'; // Ok
color = 'blue'; // Ok

// Type '"yellow"' is not assignable to type '"red" | "blue"'.
color = 'yellow'; // Error

interface StringIndexArray {
  [index: string]: string;
}

interface NumberIndexArray {
  [index: number]: string;
}

type K1 = keyof StringIndexArray; // type K1 = string | number
type K2 = keyof NumberIndexArray; // type K2 = number
```
