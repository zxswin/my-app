# 路由（Router）

## 路由完整定义

- router 下面的方法

```bash
router.head - HEAD
router.options - OPTIONS
router.get - GET
router.put - PUT
router.post - POST
router.patch - PATCH
router.delete - DELETE
router.del - 由于 delete 是一个保留字，所以提供了一个 delete 方法的别名。
router.redirect - 可以对 URL 进行重定向处理，比如我们最经常使用的可以把用户访问的根目录路由到某个主页。
router.resources 用于生成RESTful 风格的API
```

- 路由的组成部分

```bash
router-name 给路由设定一个别名，可以通过 Helper 提供的辅助函数 pathFor 和 urlFor 来生成 URL。(可选)
path-match - 路由 URL 路径。
middleware1 - 在 Router 里面可以配置多个 Middleware。(可选)
controller - 指定路由映射到的具体的 controller 上，controller 可以有两种写法：
app.controller.user.fetch - 直接指定一个具体的 controller
'user.fetch' - 可以简写为字符串形式
```

## 参数获取

- curl http://127.0.0.1:7001/search?name=egg

```js
// 路由
app.router.get('/search', app.controller.search.index);
// 参数获取
ctx.body = `search: ${ctx.query.name}`;
```

- curl http://127.0.0.1:7001/user/123/xiaoming

```js
// 路由
app.router.get('/user/:id/:name', app.controller.user.info);
// 参数获取
ctx.body = `user: ${ctx.params.id}, ${ctx.params.name}`;
```

- curl http://127.0.0.1:7001/package/egg/1.0.0(复杂参数获取)

```js
// 路由
app.router.get(
  /^\/package\/([\w-.]+\/[\w-.]+)$/,
  app.controller.package.detail
);
// 如果请求 URL 被正则匹配， 可以按照捕获分组的顺序，从 ctx.params 中获取。
// 按照下面的用户请求，`ctx.params[0]` 的 内容就是 `egg/1.0.0`
ctx.body = `package:${ctx.params[0]}`;
```

- 表单内容的获取

```js
// 路由
app.router.post('/form', app.controller.form.post);
// 获取表单内容
ctx.body = `body: ${JSON.stringify(ctx.request.body)}`;
```

## 重定向

- 内部重定向

```js
app.router.redirect('/', '/home/index', 302);
```

- 外部重定向

```js
/** 外部重定向
 * 注意是在ctx下的redirect方法
 */
ctx.redirect('https://www.baidu.com/');
```

## 注意要点

- Controller 支持子目录
