## 依赖安装

```js
// npm install express --save
```

## 简单使用案例

```js
const express = require('express');
const app = express();
const port = 3000;

app.get('/', (req, res) => {
  res.send('Hello World!');
});

app.post('/post', function (req, res) {
  res.send('Got a POST request');
});

app.put('/user', function (req, res) {
  res.send('Got a PUT request at /user');
});

app.delete('/user', function (req, res) {
  res.send('Got a DELETE request at /user');
});

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});
```

## Express 应用程序生成器

```js
// 通过应用生成器工具 express-generator 可以快速创建一个应用的骨架。
// npm install -g express-generator
```

## 利用 Express 托管静态文件

```js
const express = require('express');
const app = express();
const port = 3000;

app.get('/', (req, res) => {
  res.send('Hello World!');
});

app.use(express.static('public'));
app.use(express.static('files'));

// http://localhost:3000/images/kitten.jpg
// http://localhost:3000/css/style.css
// http://localhost:3000/js/app.js
// http://localhost:3000/images/bg.png
// http://localhost:3000/hello.html

// 可以通过带有 /static 前缀地址来访问 public 目录中的文件了
// app.use('/static', express.static('public'));
// http://localhost:3000/static/images/kitten.jpg
// http://localhost:3000/static/css/style.css
// http://localhost:3000/static/js/app.js
// http://localhost:3000/static/images/bg.png
// http://localhost:3000/static/hello.html

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});
```

## express 中获取参数

```js
const express = require('express');

const app = express();
const port = 3000;

// req.body就不会为undefined了
var bodyParser = require('body-parser');
app.use(bodyParser.json());
// 为true的时候，则可为任何数据类型。
app.use(bodyParser.urlencoded({ extended: false }));

app.get('/users/:id', (req, res) => {
  // http://localhost:3000/users/15
  res.send(req.params.id); // 15
});

app.get('/users', (req, res) => {
  // url参数的获取
  // http://localhost:3000/users?id=12&data=89
  res.send(req.query.data); // 89
});

app.post('/user', (req, res) => {
  // body的获取
  const body = req.body;
  console.log('body===', body);

  res.send(body);
});

app.get('/header', (req, res) => {
  // header的获取
  const myUrl = req.get('MY-URL');
  console.log(myUrl);

  // header的设置
  res.set({
    'Content-Type': 'text/plain',
    'Content-Length': '123',
    ETag: '12345',
  });
  res.send(myUrl);
});

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});
```

## Express 中的 Cookie 使用

```js
// npm i cookie-parser -S
const express = require('express');

const app = express();
const port = 3000;

const cookieParser = require('cookie-parser');
app.use(cookieParser()); //配置

app.get('/cookie', (req, res) => {
  // 设置cookie
  // 1.maxAge:10006060过期时间 ，时间到了自动销毁
  // 2.path:"/admin" 代表着哪些路由可以访问cookie
  // 3.domain:".bin.com" 在不同域名下访问cookie，实现cookie共享
  // 4.signed:true cookie 加密 分为两步 第一部在配置中间件的时候配置加密字段 ,字段越长越复杂app.use(cookieParser('asdc'))
  // 第二部在设置cookie的时候设置 res.cookie('username',username,{maxAge:1000*60*60,signed:true})
  // 获取的时候使用req.signedCookies.username

  res.cookie('username', '张三', { maxAge: 1000 * 60 * 60 }); //参数一cookie名  ，参数二cookie值，参数三，cookie过期时间等等配置参数

  // 获取cookie
  let name = req.cookies.username;

  res.send(name);
});

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});
```

## Express 中的 状态码的设置

```js
const express = require('express');

const app = express();
const port = 3000;

app.get('/status', (req, res) => {
  res.statusCode = 400;
  res.send('statusCode 400');
});

app.listen(port, () => {
  console.log(`Example app listening on port ${port}`);
});
```

## 文件上传

```js
const express = require('express');
const app = new express();
const multer = require('multer');
const fs = require('fs');
app.use(express.json());
app.use(express.urlencoded({ extended: false }));
//array中的名称要和表单中的名称一致
app.use(multer({ dest: '/' }).array('imgs'));
app.get('/', (request, response) => {
  response.sendFile(__dirname + '/index.html');
});
app.post('/upload', (request, response) => {
  if (request.files.length !== 0) {
    let sava_path = __dirname + '/images/' + request.files[0].originalname;
    console.log(sava_path);
    let file_body = fs.readFileSync(request.files[0].path);
    fs.writeFile(sava_path, file_body, (err, data) => {
      if (err) response.send(err);
      let response_body = {
        msg: `${request.files[0].originalname} upload success`,
      };
      response.json(response_body);
    });
  }
});
app.listen(80);
```

## 使用 Express 的重定向功能

```js
// res.redirect() 函数 将用户重定向到不同的 URL 状态为 302 的 HTTP 响应 。 然后，HTTP 客户端（浏览器、 Axios 等）将跟随重定向并向新 URL 发送 HTTP 请求

const app = require('express')();

app.get('/from', (req, res) => {
  res.redirect('/to');
});
app.get('/to', (req, res) => res.send('Hello, World!'));

const server = await app.listen(3000);

const res = await axios.get('http://localhost:3000/from');
res.data;
```

```js
// 这 res.redirect() 函数还允许您指定 302 以外的 HTTP 状态。302 状态被视为临时重定向 ，这意味着搜索引擎仍将抓取现有 URL。 如果您想指示 URL 已永久更改，则应发送带有 HTTP 状态 301 。

const app = require('express')();

app.get('/from', (req, res) => {
  res.redirect(301, '/to');
});

app.get('/to', (req, res) => res.send('Hello, World!'));
const server = await app.listen(3000);
const res = await axios.get('http://localhost:3000/from');
// "Hello, World!"
res.data;
```

```js
// 关于应该为 POST 请求使用哪个状态代码存在一些细微差别。
// 严格来说， 不需要保持相同的方法和正文内容 在重定向时 如果要重定向 POST 请求，则应使用 HTTP 307 替代 HTTP 302，并 HTTP 308 替代 HTTP 301。

const app = require('express')();
// Parser to set `req.body`
app.use(require('body-parser').json());

app.post('/from', (req, res) => {
  res.redirect(307, '/to');
});
app.post('/to', (req, res) => res.send(req.body.message));

const server = await app.listen(3000);

const res = await axios.post('http://localhost:3000/from', {
  message: 'Hello, World!',
});
// "Hello, World!"
res.data;
```

## 参考资料

```js
// https://www.expressjs.com.cn/
```
