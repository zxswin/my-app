## 11.使用 context 在组件间共享数据

- context 的作用

```tsx
/**
 * context提供了一个无需再每层组件手动添加Props 就能在组件树间进行数据传递的方法
 * 当Provider嵌套使用的时候,里层的会覆盖外层的数据
 * 当Provider的value值发生变化的时候,他内部的所有消费者组件都会从新渲染
 * Provider 及其内部 consumer 组件都不受制于 shouldComponentUpdate 函数
 */

import React, { Component } from 'react';

// 通过React.createContext创建一个Context对象
// 组件会从组件树中离自身最近的那个匹配的Provider中读取当前的context值

// 只有当中所以的树中没有匹配到Provider时,defaultValue才会生效
// 将undefined传递给Provide的value时,消费组件的default不会生效

const ThemeContext = React.createContext('light');

/**  父组件共享了context数据  */
class HookCom extends Component<any, any> {
  constructor(props) {
    super(props);

    this.state = {};
  }

  render() {
    return (
      <ThemeContext.Provider value="dark">
        <ToolBar />
      </ThemeContext.Provider>
    );
  }
}

/** 中间组件再也不用明确往下传递theme了  */
function ToolBar() {
  return (
    <div>
      <ThemeButton />
    </div>
  );
}

/** 使用到context共享数据的按钮组件  */
class ThemeButton extends Component {
  // 挂载再class上的静态属性contextType 被赋值为一个由React.createContext()创建的Context对象
  // 这样class内部就可以使用this.context来访问到Context上的值
  static contextType = ThemeContext;

  render() {
    return <button style={{ background: this.context === 'dark' ? 'red' : '' }}>主题颜色按钮</button>;
  }
}

export default HookCom;
```

- Context.Consumer 的使用

```tsx
/**
 * 基本用法:
 * <MyContext.Consumer>
 *{value => 基于 context 值进行渲染}
 * </MyContext.Consumer>
 */

// 父组件List.txs
import React, { Component } from 'react';
import Son from './Son';

// 创建一个 Context,
export const { Provider, Consumer } = React.createContext({ name: '名称' });

class List extends Component<any, any> {
  contentData = {
    name: '共享名称',
  };
  constructor(props) {
    super(props);
  }
  render() {
    return (
      <Provider value={this.contentData}>
        <Son />
      </Provider>
    );
  }
}

export default List;

// 子组件Son
import React from 'react';
import { Consumer } from './List';

function Son(props: any) {
  return (
    <Consumer>
      {(contentData) => (
        <div>
          <p>获取到List共享名称: {contentData.name}</p>
        </div>
      )}
    </Consumer>
  );
}

export default Son;
```
