# validatorjs 校验插件

## 基本使用

```ts
// 安装
// npm install -S validatorjs
// npm install -S @types/validatorjs

// 引入
import Validator from 'validatorjs';
// 设置语音
Validator.useLang('zh');

let validator = new Validator(
  {
    name: '小小明',
    email: '123@11com',
  },
  {
    name: 'size:3',
    email: 'required|email',
  }
);

// 自定义属性名
validator.setAttributeNames({ name: '姓名', email: '邮箱' });

// 校验失败
validator.fails(() => {
  console.log('校验失败!');
});

// 校验成功
validator.passes(() => {
  console.log('校验成功!');
});

// 错误提示信息
const first = validator.errors.first('email'); // 获取第一条错误信息 如果没有信息则返回false
const get = validator.errors.get('email'); // 获取所有校验失败信息的数组
```

## 嵌套对象的验证

```ts
let data = {
  name: 'John',
  bio: {
    age: 2,
    education: {
      primary: 'Elementary School',
      secondary: 'Secondary School',
    },
  },
};

let flattened = {
  name: 'required',
  'bio.age': 'min:18',
  'bio.education.primary': 'string',
  'bio.education.secondary': 'string',
};

let validator = new Validator(data, flattened);

// 自定义属性名
validator.setAttributeNames({ name: '姓名', 'bio.age': '年龄' });

// 校验失败
validator.fails(() => {
  console.log('校验失败!');
});

// 校验成功
validator.passes(() => {
  console.log('校验成功!');
});

// 错误提示信息
const first = validator.errors.first('bio.age'); // 获取第一条错误信息 如果没有信息则返回false
const get = validator.errors.get('bio.age'); // 获取所有校验失败信息的数组

console.log('first', first);
console.log('get', get);
```

## 校验规则

```ts
// required 必填不得为空或undefined
// accepted  必须为yes, on, 1 或 true
// after:date
// after_or_equal:date
// alpha 只能包含字母
// alpha_dash 只能包含字母,连字符和下划线
// alpha_num 只能包含字母和数字
// array 必须是一个数组
// before:date
// before_or_equal:date
// between:min,max (大小,长度等)只能在10和20之间.
// boolean true, false, 0, 1
// date日期格式
// digits:value  必须为几位数字
// digits_between:min,max  数字的位数必须介于最大值和最小值之间
// different:attribute 不能和给定的字段的值相同
// email 必须为邮箱格式
// hex 必须为16进账制数
// in:foo,bar,... 必须在给到的列表中
// integer 必须为整数
// max:value 最大值
// min:value 最小值
// not_in:foo,bar,... 验证的值不在列表中
// numeric 必须为数字类型
// present 必须存在于输入数据中
// required 必填字段校验 不得为空
// required_if:anotherfield,value  如果其他字段等于任何值，则验证中的字段必须存在且不为空
// required_unless:anotherfield,value 正在验证的字段必须存在且不为空，除非另一个字段等于任何值。
// required_with:foo,bar,... 只有当其他指定字段存在时，验证中的字段才必须存在且不为空。
// required_with_all:foo,bar,... 只有当所有其他指定字段都存在时，验证中的字段才必须存在而不是空的
// required_without:foo,bar,.. 仅当其他指定字段不存在时，验证中的字段必须存在且不为空
// required_without_all:foo,bar,... 只有当所有其他指定字段都不存在时，验证中的字段才必须存在且不为空。
// same:attribute 给定字段必须与正在验证的字段匹配
// size:value  正在验证的字段必须具有与给定值匹配的大小
// string 字符串
// url 网址
// regex:pattern 正则表达式 用于自定义校验规则
```

## 使用正则表达式自定义校验规则

```ts
let data = {
  name: '19200',
};

let flattened = {
  name: ['required', 'regex:/^(19|20)[\\d]{2,2}$/'],
};

let validator = new Validator(data, flattened);
```

## 当年龄为 30 的时候姓名不得为空

```ts
let data = {
  age: 30,
  name: '',
};

let flattened = {
  age: ['required', { in: [29, 30] }],
  name: [{ required_if: ['age', 30] }],
};

let validator = new Validator(data, flattened);
```

## 注册自定义验证规则

```ts
Validator.register(
  'telephone',
  function (value: any, requirement, attribute) {
    return value.match(/^\d{3}-\d{3}-\d{4}$/);
  },
  ':attribute 的格式必须为 XXX-XXX-XXXX.'
);

let data = {
  name: '',
};

let flattened = {
  name: `required|telephone`,
};

let validator = new Validator(data, flattened);
```

## 自定义错误信息

```ts
let data = {
  name: '',
};

let flattened = {
  name: `required`,
};

let validator = new Validator(data, flattened, { required: ':attribute 不得为空 自定义提示' });

// 针对指定字段的自定义提示
let data = {
  name: '',
  email: '',
};

let flattened = {
  name: `required`,
  email: `required`,
};

let validator = new Validator(data, flattened, { 'required.email': ':attribute 不得为空 自定义提示' });
```

## 自定义属性名

```ts
// 自定义属性名
validator.setAttributeNames({ name: '姓名', 'bio.age': '年龄' });

// 自定义属性名
Validator.setAttributeFormatter(function (attribute) {
  return attribute.replace(/_/g, ' ');
});
```

## 设置语言

```ts
// 设置语音
Validator.useLang('zh');

// 修改提示语言内容
let messages = Validator.getMessages('en');
messages.required = 'Whoops, :attribute field is required.';
Validator.setMessages('en', messages);

// 获取默认语言
Validator.getDefaultLang();

// 自定义语言
Validator.setMessages('lang_code', {
  required: 'The :attribute field is required.',
});

Validator.getMessages('lang_code');

Validator.useLang('lang_code');
```
