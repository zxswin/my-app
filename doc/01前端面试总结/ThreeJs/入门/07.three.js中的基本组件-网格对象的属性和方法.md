## three.js 中的基本组件-网格对象的属性和方法

## 创建网格

```js
// 创建网格需要一个几何体，以及一个或者多个材料。当网格创建好后，我就可以添加到场景中进行渲染。
// 网格提供了几个属性，用于展示网格的位置和效果。

// position	该属性用于定义该对象相对父对象的位置
// rotation	设置绕每个轴旋转的弧度，还可以使用 rotateX() rotateY() rotateZ() 来设置绕特定轴
// scale	缩放对象
// translateX(amount)	沿X轴平移
// translateY(amount)	沿Y轴平移
// translateZ(amount)	沿Z轴平移
// visible	false时将不会被渲染
```

- position：定义该对象相对父对象的位置

```js
// position：定义该对象相对父对象的位置
// 有三种设置方式：

cube.position.x = 10;
cube.position.y = 10;
cube.position.z = 10;
cube.position.set(10, 10, 10);
cube.position = new THREE.Vector3(10, 10, 10);
```

- rotation：设置绕每个轴旋转的弧度

```js
// rotation：设置绕每个轴旋转的弧度
// 在数学上，旋转一周的弧度值为 2Π，可以用如下三种方式来设置旋转：

cube.rotation.x = 0.5 * Math.PI;
cube.rotation.set(0.5 * Math.PI, 0, 0);
cube.rotation = new THREE.Vector3(0.5 * Math.PI, 0, 0);
// 还记得我们在Canvas专栏中学的吗，如果想用度数来设置旋转，我们可以这样写：
degress * (Math.PI / 180);
```

## 测试代码

```js
// 导入 three.js 包
import * as THREE from 'three';
// 导入帧率统计包
import Stats from 'three/examples/js/libs/stats.min.js';
// 导入dat.gui
import { GUI } from 'dat.gui';
// 用于鼠标移动镜头
import { TrackballControls } from 'three/examples/jsm/controls/TrackballControls';
export default () => {
  // 保存希望被GUI改变的属性
  let controls = {
    positionX: 0,
    positionY: 3,
    positionZ: 0,
    rotationX: 0,
    rotationY: 0,
    rotationZ: 0,
  };

  // 帧率统计 0 fps 1 ms 2 mb 3 custom
  function initStats(type) {
    var panelType =
      typeof type !== 'undefined' && type && !isNaN(type) ? parseInt(type) : 0;
    var stats = new Stats();
    stats.showPanel(panelType);
    document.body.appendChild(stats.dom);
    return stats;
  }
  const stats = initStats();
  // 定义场景
  const scene = new THREE.Scene();
  // 定义摄像机
  const camera = new THREE.PerspectiveCamera(
    45,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  );
  // 定义渲染器
  const renderer = new THREE.WebGLRenderer();
  // 定义场景的颜色为黑色
  renderer.setClearColor(0x000000);
  // 定义场景大小为整个窗口
  renderer.setSize(window.innerWidth, window.innerHeight);
  // 启动渲染阴影效果
  renderer.shadowMap.enabled = true;
  // 创建一个粗细为20的坐标轴
  const axes = new THREE.AxesHelper(20);
  scene.add(axes);

  // 添加光源
  const spotLight = new THREE.SpotLight(0xffffff);
  spotLight.position.set(-40, 40, -15);
  spotLight.castShadow = true;
  spotLight.shadow.mapSize = new THREE.Vector2(1024, 1024);
  spotLight.shadow.camera.far = 130;
  spotLight.shadow.camera.near = 40;
  scene.add(spotLight);

  // 创建一个宽为60，高为20的的平面。
  const planeGeometry = new THREE.PlaneGeometry(60, 40);
  // 设置平面的材质
  const planeMaterial = new THREE.MeshLambertMaterial({
    color: 0xffffff,
  });
  // 赋值到Mesh
  const plane = new THREE.Mesh(planeGeometry, planeMaterial);
  // 设置平面位置和旋转
  plane.rotation.x = -0.5 * Math.PI;
  plane.position.set(15, 0, 0);
  // 设置地面为投影面
  plane.receiveShadow = true;
  // 将平面添加到场景中
  scene.add(plane);

  // 创建一个立方体
  const cubeGeometry = new THREE.BoxGeometry(4, 4, 4);
  const cubeMaterial = new THREE.MeshLambertMaterial({
    color: 0xff0000,
  });
  const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
  cube.position.set(0, 3, 0);
  // 开启投影
  cube.castShadow = true;
  scene.add(cube);

  // 实例化GUI
  const gui = new GUI();
  const guiPosition = gui.addFolder('position');
  const contX = guiPosition.add(controls, 'positionX', -10, 10);
  const contY = guiPosition.add(controls, 'positionY', -4, 20);
  const contZ = guiPosition.add(controls, 'positionZ', -10, 10);
  contX.listen();
  contX.onChange(function () {
    cube.position.x = controls.positionX;
    // cube.children[1].position.x = controls.positionX;
  });
  contY.listen();
  contY.onChange(function () {
    cube.position.y = controls.positionY;
  });
  contZ.listen();
  contZ.onChange(function () {
    cube.position.z = controls.positionZ;
  });
  const guiRotation = gui.addFolder('rotation');
  guiRotation.add(controls, 'rotationX', -4, 4);
  guiRotation.add(controls, 'rotationY', -4, 4);
  guiRotation.add(controls, 'rotationZ', -4, 4);

  // 设置摄像机的位置
  camera.position.set(-30, 40, 30);
  // 摄像机指向场景中心
  camera.lookAt(scene.position);
  // 将渲染的结果加入到div中
  document.querySelector('#webgl-box').appendChild(renderer.domElement);
  // 实现鼠标移动摄像头
  const trackballControls = new TrackballControls(camera, renderer.domElement);
  const clock = new THREE.Clock();

  // 帧率动画
  function renderScence() {
    // 跟新帧率控件的展示
    stats.update();
    trackballControls.update(clock);
    cube.rotation.x = controls.rotationX;
    cube.rotation.y = controls.rotationY;
    cube.rotation.z = controls.rotationZ;

    requestAnimationFrame(renderScence);
    renderer.render(scene, camera);
  }
  renderScence();

  // 窗口大小改变后，改变摄像头
  const onResize = () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  };
  window.addEventListener('resize', onResize, false);
};
```
