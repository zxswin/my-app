## Jest 设置和拆卸

- 每个单元测试执行之前或执行之后都会执行 ​beforeEach,​beforeEach

```js
// 如果你有一些要为多次测试重复设置的工作，你可以使用 ​beforeEach ​和 ​beforeEach
beforeEach(() => {
  initializeCityDatabase();
});
afterEach(() => {
  clearCityDatabase();
});
test('city database has Vienna', () => {
  expect(isCity('Vienna')).toBeTruthy();
});
test('city database has San Juan', () => {
  expect(isCity('San Juan')).toBeTruthy();
});

// beforeEach ​和 ​afterEach ​能够通过与 异步代码测试 相同的方式处理异步代码
// 他们可以采取 ​done ​参数或返回一个 promise。
// 如果 ​initializeCityDatabase() ​返回解决数据库初始化时的 promise ，我们会想返回这一 promise
beforeEach(() => {
  return initializeCityDatabase();
});

```

- 一次性设置

```js
// 在某些情况下，你只需要在文件的开头做一次设置。当设置是异步的时，这可能会特别麻烦，因此你就不能内联执行。
// Jest 提供 ​beforeAll ​和 ​afterAll ​处理这种情况。
// 如果 ​initializeCityDatabase ​和 ​clearCityDatabase ​都返回了 promise ，
// 城市数据库可以在测试中重用，我们就能把我们的测试代码改成这样:
beforeAll(() => {
  return initializeCityDatabase();
});
afterAll(() => {
  return clearCityDatabase();
});
test('city database has Vienna', () => {
  expect(isCity('Vienna')).toBeTruthy();
});
test('city database has San Juan', () => {
  expect(isCity('San Juan')).toBeTruthy();
});
```

- 作用域

```js
// 当 ​before ​和 ​after ​的块在 ​describe ​块内部时，则其只适用于该 ​describe ​块内的测试
describe('matching cities to foods', () => {
  // Applies only to tests in this describe block
  beforeEach(() => {
    return initializeFoodDatabase();
  });
  test('Vienna <3 sausage', () => {
    expect(isValidCityFoodPair('Vienna', 'Wiener Schnitzel')).toBe(true);
  });
  test('San Juan <3 plantains', () => {
    expect(isValidCityFoodPair('San Juan', 'Mofongo')).toBe(true);
  });
});
```

- 钩子的顺序
```js
// 顶级的 ​beforeEach ​在 ​describe ​块级的 ​beforeEach ​之前被执行。 这可能有助于说明所有钩子的执行顺序。
beforeAll(() => console.log('1 - beforeAll'));
afterAll(() => console.log('1 - afterAll'));
beforeEach(() => console.log('1 - beforeEach'));
afterEach(() => console.log('1 - afterEach'));
test('', () => console.log('1 - test'));
describe('Scoped / Nested block', () => {
  beforeAll(() => console.log('2 - beforeAll'));
  afterAll(() => console.log('2 - afterAll'));
  beforeEach(() => console.log('2 - beforeEach'));
  afterEach(() => console.log('2 - afterEach'));
  test('', () => console.log('2 - test'));
});
// 1 - beforeAll
// 1 - beforeEach
// 1 - test
// 1 - afterEach
// 2 - beforeAll
// 1 - beforeEach
// 2 - beforeEach
// 2 - test
// 2 - afterEach
// 1 - afterEach
// 2 - afterAll
// 1 - afterAll
```

```js
// 如果测试失败，第一件要检查的事就是，当仅运行这条测试时，它是否仍然失败。
// 要使用Jest仅运行一个​test​，请将该测试命令临时更改为​test.only​:
test.only('this will be the only test that runs', () => {
  expect(true).toBe(false);
});
test('this test will not run', () => {
  expect('A').toBe('A');
});
```