## Jest 与 Webpack 一起使用


- webpack.config.js

```js
// 如果你有 Babel 转换的 JavaScript 文件，你可以通过安装babel-jest​插件来启用对 Babel 的支持。
// 可以使用 Jest 的transform配置选项处理非 Babel JavaScript 转换。


module.exports = {
  module: {
    loaders: [
      {exclude: ['node_modules'], loader: 'babel', test: /\.jsx?$/},
      {loader: 'style-loader!css-loader', test: /\.css$/},
      {loader: 'url-loader', test: /\.gif$/},
      {loader: 'file-loader', test: /\.(ttf|eot|svg)$/},
    ],
  },
  resolve: {
    alias: {
      config$: './configs/app-config.js',
      react: './vendor/react-master',
    },
    extensions: ['', 'js', 'jsx'],
    modules: [
      'node_modules',
      'bower_components',
      'shared',
      '/shared/vendor/modules',
    ],
  },
};
```

- 处理静态文件

```js
// package.json
{
  "jest": {
    "moduleNameMapper": {
      "\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$": "<rootDir>/__mocks__/fileMock.js",
      "\\.(css|less)$": "<rootDir>/__mocks__/styleMock.js"
    }
  }
}

// __mocks__/styleMock.js
module.exports = {};


// __mocks__/fileMock.js
module.exports = 'test-file-stub';
```

- 模拟 CSS 模块

```js
// 模拟 CSS 模块
// 你可以使用 ES6 Proxy来模拟一个 CSS :
// yarn add --dev identity-obj-proxy


// 然后在样式对象上，你的所有​className​查找都会原样返回 (如 ​styles.foobar === 'foobar'​) 这对React的快照测试是相当方便的.

// package.json (for CSS Modules)

// 请注意，代理在节点 6 中默认启用。如果你还没有使用 Node 6，请确保你使用​node --harmony_proxies node_modules/.bin/jest​.

{
  "jest": {
    "moduleNameMapper": {
      "\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$": "<rootDir>/__mocks__/fileMock.js",
      "\\.(css|less)$": "identity-obj-proxy"
    }
  }
}

```

```js
// moduleNameMapper​不能满足你的要求，可以使用 Jest 的transform配置选项来指定如何转换资产。
// 例如，一个返回文件基名的转换器（如​require('logo.jpg');​return 'logo'​）可以写成：

// fileTransformer.js
const path = require('path');
module.exports = {
  process(src, filename, config, options) {
    return 'module.exports = ' + JSON.stringify(path.basename(filename)) + ';';
  },
};

// package.json (for custom transformers and CSS Modules)
{
  "jest": {
    "moduleNameMapper": {
      "\\.(css|less)$": "identity-obj-proxy"
    },
    "transform": {
      "\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$": "<rootDir>/fileTransformer.js"
    }
  }
}
```

```js
// 如果你babel-jest和额外的代码预处理器，你必须明确的定义babel-jest为你的Js代码的转换器，并且你需要映射所有​.js​文件到babel-jest模块。
"transform": {
  "^.+\\.js$": "babel-jest",
  "^.+\\.css$": "custom-transformer",
  ...
}
```


## 配置Jest来搜寻文件

```js
// 现在Jest知道如何处理我们的文件了， 接下来我们需要告诉它如何找到它们。 
// webpack的​modulesDirectories​ 和 ​extensions ​选项都是和Jest的​moduleDirectories ​和 ​moduleFileExtensions​选项类似的.


// <rootDir>​是一个特殊的标记，它会被 Jest 替换为项目的根目录。大多数情况下，这将是​package.json​所在的文件夹，​​除非​rootDir​在配置中指定自定义选项。


// package.json
{
  "jest": {
    "moduleFileExtensions": ["js", "jsx"],
    "moduleDirectories": ["node_modules", "bower_components", "shared"],
    "moduleNameMapper": {
      "\\.(css|less)$": "<rootDir>/__mocks__/styleMock.js",
      "\\.(gif|ttf|eot|svg)$": "<rootDir>/__mocks__/fileMock.js"
    }
  }
}

```

```js
// 同样，webpack 的​resolve.root​选项功能类似于设置​​NODE_PATH​ ​可变​​变量，可以设置或使用该​modulePaths​选项。
// package.json
{
  "jest": {
    "modulePaths": ["/shared/vendor/modules"],
    "moduleFileExtensions": ["js", "jsx"],
    "moduleDirectories": ["node_modules", "bower_components", "shared"],
    "moduleNameMapper": {
      "\\.(css|less)$": "<rootDir>/__mocks__/styleMock.js",
      "\\.(gif|ttf|eot|svg)$": "<rootDir>/__mocks__/fileMock.js"
    }
  }
}

// 最后，我们必须处理 webpack ​alias​。为此，我们可以​moduleNameMapper​再次使用该选项。
// 注︰ 对于更复杂的 webpack 配置，你可能需要研究一些项目，例如︰ babel-plugin-webpack-loaders。
// package.json
{
  "jest": {
    "modulePaths": ["/shared/vendor/modules"],
    "moduleFileExtensions": ["js", "jsx"],
    "moduleDirectories": ["node_modules", "bower_components", "shared"],
    "moduleNameMapper": {
      "\\.(css|less)$": "<rootDir>/__mocks__/styleMock.js",
      "\\.(gif|ttf|eot|svg)$": "<rootDir>/__mocks__/fileMock.js",
      "^react(.*)$": "<rootDir>/vendor/react-master$1",
      "^config$": "<rootDir>/configs/app-config.js"
    }
  }
} 
```