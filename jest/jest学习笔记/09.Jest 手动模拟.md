## Jest 手动模拟

```js
// 手动模拟用于通过模拟数据来剔除功能。例如，你可能希望创建一个允许使用假数据的手动模拟，而不是访问像网站或数据库这样的远程资源。这将确保你的测试速度快，而且不会出现问题。
```

- 模拟用户模块

```js
// 手动模拟是通过在​__mocks__/​紧邻模块的子目录中编写模块来定义的。例如，mock 一个名为模块​user​的​models​目录下，创建一个名为​user.js​，并把它的​models/__mocks__​目录中。请注意，​__mocks__​文件夹区分大小写，因此命名目录​__MOCKS__​在某些系统上会中断。

// 当我们需要在我们的测试，模块，显式调用​jest.mock('./moduleName')​是必需的。
```

- 模拟节点模块

```js
.
├── config
├── __mocks__
│   └── fs.js
├── models
│   ├── __mocks__
│   │   └── user.js
│   └── user.js
├── node_modules
└── views
```
```js
// 注意：为了正确模拟，Jest 需要​jest.mock('moduleName')​与​require/import​语句在同一范围内。

// 这是一个人为的示例，其中我们有一个模块，该模块提供给定目录中所有文件的摘要。在这种情况下，我们使用核心（内置）​fs​模块。
// FileSummarizer.js
'use strict';
const fs = require('fs');
function summarizeFilesInDirectorySync(directory) {
  return fs.readdirSync(directory).map(fileName => ({
    directory,
    fileName,
  }));
}
exports.summarizeFilesInDirectorySync = summarizeFilesInDirectorySync;

// 我们的手动模拟将实现​fs​我们可以为测试构建的API 的自定义版本：

// __mocks__/fs.js
'use strict';
const path = require('path');
const fs = jest.createMockFromModule('fs');
// This is a custom function that our tests can use during setup to specify
// what the files on the "mock" filesystem should look like when any of the
// `fs` APIs are used.
let mockFiles = Object.create(null);
function __setMockFiles(newMockFiles) {
  mockFiles = Object.create(null);
  for (const file in newMockFiles) {
    const dir = path.dirname(file);
    if (!mockFiles[dir]) {
      mockFiles[dir] = [];
    }
    mockFiles[dir].push(path.basename(file));
  }
}
// A custom version of `readdirSync` that reads from the special mocked out
// file list set via __setMockFiles
function readdirSync(directoryPath) {
  return mockFiles[directoryPath] || [];
}
fs.__setMockFiles = __setMockFiles;
fs.readdirSync = readdirSync;
module.exports = fs;


// 现在我们编写我们的测试。请注意，我们需要明确说明我们要模拟该​fs​模块，因为它是一个核心 Node 模块：
// __tests__/FileSummarizer-test.js
'use strict';
jest.mock('fs');
describe('listFilesInDirectorySync', () => {
  const MOCK_FILE_INFO = {
    '/path/to/file1.js': 'console.log("file1 contents");',
    '/path/to/file2.txt': 'file2 contents',
  };
  beforeEach(() => {
    // Set up some mocked out file info before each test
    require('fs').__setMockFiles(MOCK_FILE_INFO);
  });
  test('includes all files in the directory in the summary', () => {
    const FileSummarizer = require('../FileSummarizer');
    const fileSummary = FileSummarizer.summarizeFilesInDirectorySync(
      '/path/to',
    );
    expect(fileSummary.length).toBe(2);
  });
});



```